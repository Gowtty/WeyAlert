<div class="map-page-container relative flex min-h-screen w-full flex-col bg-background-light dark:bg-background-dark font-display">
    
    <!-- Map Container -->
    <div id="map-container" class="absolute inset-0 z-10"></div>

    <div class="absolute inset-0 bg-background-dark/80 backdrop-blur-sm z-0 pointer-events-none"></div>

    <main class="relative flex flex-1 flex-col items-center p-0 pt-4">
        
        <div class="absolute top-4 left-1/2 -translate-x-1/2 w-full max-w-lg p-4 bg-background-dark/90 rounded-xl shadow-2xl flex flex-col gap-3 pointer-events-auto sm:top-6 z-30">
            
            <!-- Search Bar Container -->
            <div class="w-full">
                <div class="relative w-full">
                    <!-- Search Icon -->
                    <span class="material-symbols-outlined pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-primary mt-0.5"
                          style="font-family: 'Material Symbols Outlined'; font-weight: normal; font-style: normal; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; font-feature-settings: liga; -webkit-font-feature-settings: 'liga'; -webkit-font-smoothing: antialiased;">
                        search
                    </span>
                    
                    <!-- Search Input with Autocomplete -->
                    <input class="w-full rounded-full border-none bg-background-dark/80 py-3 pl-12 pr-4 text-white placeholder-white/50 focus:ring-2 focus:ring-primary shadow-xl" 
                           placeholder="Buscar ubicación..." 
                           type="text"
                           [value]="searchQuery"
                           (input)="onSearchInput($any($event.target).value)"
                           (keydown)="onSearchKeydown($event)"
                           (blur)="hideSuggestions()" />
                    
                    <!-- Autocomplete Dropdown -->
                    <div *ngIf="showSuggestions && searchSuggestions.length > 0" 
                         class="absolute top-full left-0 right-0 mt-2 bg-background-dark/95 rounded-xl shadow-2xl overflow-hidden z-50 max-h-60 overflow-y-auto">
                        <div *ngFor="let suggestion of searchSuggestions; let i = index"
                             (click)="selectSuggestion(suggestion)"
                             [ngClass]="{'bg-primary/20': i === selectedSuggestionIndex}"
                             class="px-4 py-3 cursor-pointer hover:bg-primary/10 transition-colors border-b border-white/5 last:border-0">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-primary mt-0.5 !text-lg">location_on</span>
                                <div class="flex-1">
                                    <div class="text-white text-sm font-medium line-clamp-1">
                                        {{ suggestion.name || suggestion.display_name.split(',')[0] }}
                                    </div>
                                    <div class="text-gray-400 text-xs mt-1 line-clamp-2">
                                        {{ suggestion.display_name }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coords Display and Create Button -->
            <div class="flex justify-between items-center w-full pt-2 border-t border-white/10">
                <div class="text-gray-400">
                    <p class="font-semibold text-white">Ubicación de Alerta:</p>
                    <p *ngIf="selectedLatitude !== null" class="text-sm">
                        Lat: {{ selectedLatitude | number: '1.4-4' }}, 
                        Lng: {{ selectedLongitude | number: '1.4-4' }}
                    </p>
                    <p *ngIf="selectedLatitude === null" class="text-xs text-primary">
                        Haz clic en el mapa para seleccionar.
                    </p>
                </div>
                
                <button 
                    (click)="onCreateAlert()"
                    [disabled]="selectedLatitude === null"
                    class="py-3 px-6 bg-primary text-background-dark font-bold rounded-lg shadow-lg disabled:opacity-50 transition-transform hover:scale-105">
                    <span class="material-symbols-outlined mr-1 !text-base">add_road</span>
                    Crear Alerta
                </button>
            </div>
        </div>
     
        
        <!-- Floating Controls (Left Side) -->
        <div class="absolute top-44 left-4 flex flex-col gap-2 pointer-events-auto sm:top-52 z-30">
           <!-- Alert Count Badge -->
           <div *ngIf="alertsVisible && alerts.length > 0" 
                class="flex flex-col items-center justify-center space-y-0">   
                <div class="flex h-14 w-14 items-center justify-center rounded-full bg-background-dark/90 shadow-xl backdrop-blur-sm">
                    <div class="text-center">
                        <span class="text-primary font-bold">{{getAlertCount()}}</span>
                    </div>
                </div>
                
                <div class="relative flex h-7 w-16 items-center justify-center rounded-2xl bg-background-dark/90 shadow-xl backdrop-blur-sm -mt-2 bottom-3">
                    <div class="text-center">
                        <span class="text-primary text-xs">alertas</span>
                    </div>
                </div>   
            </div>              
            <!-- Locate Me Button -->
            <button (click)="locateUser()" class="flex h-14 w-14 items-center justify-center rounded-full bg-background-dark/70 text-white shadow-xl backdrop-blur-sm transition-colors hover:bg-primary/20">
                <span class="material-symbols-outlined text-primary !text-3xl">near_me</span>
            </button>
            
            <!-- Toggle Alerts Button -->
            <button (click)="toggleAlerts()" 
                    [ngClass]="{'bg-primary/30': alertsVisible}"
                    class="flex h-14 w-14 items-center justify-center rounded-full bg-background-dark/70 text-white shadow-xl backdrop-blur-sm transition-colors hover:bg-primary/20">
                <span class="material-symbols-outlined !text-3xl" [ngClass]="{'text-primary': alertsVisible, 'text-white': !alertsVisible}">
                    {{alertsVisible ? 'visibility' : 'visibility_off'}}
                </span>
            </button>
            
            <!-- Refresh Alerts Button -->
            <button (click)="refreshAlerts()" 
                    *ngIf="alertsVisible"
                    class="flex h-14 w-14 items-center justify-center rounded-full bg-background-dark/70 text-white shadow-xl backdrop-blur-sm transition-colors hover:bg-primary/20">
                <span class="material-symbols-outlined text-primary !text-3xl">refresh</span>
            </button>
        </div>

        <div class="absolute top-4 right-4 flex flex-col items-end gap-4 pointer-events-auto sm:top-6 z-30">
            <!-- Category Filter Panel -->
            <div *ngIf="alertsVisible && availableCategories.length > 0" 
                 class="max-w-xs bg-background-dark/90 rounded-xl shadow-2xl p-4">
                <h3 class="text-white font-bold mb-3 flex items-center justify-between">
                    <span>Filtrar Alertas</span>
                    <span class="text-xs text-gray-400">{{getTimeSinceUpdate()}}</span>
                </h3>
                <div class="space-y-2 max-h-60 overflow-y-auto">
                    <div *ngFor="let category of availableCategories" 
                         (click)="toggleCategory(category.key)"
                         class="flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-colors hover:bg-white/10"
                         [ngClass]="{'bg-white/20': selectedCategories.has(category.key)}">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center" 
                             [style.backgroundColor]="category.color">
                            <span class="material-symbols-outlined text-white !text-sm">{{category.icon}}</span>
                        </div>
                        <span class="text-white text-sm flex-1">{{category.name}}</span>
                        <span class="material-symbols-outlined text-white !text-lg">
                            {{selectedCategories.has(category.key) ? 'check_box' : 'check_box_outline_blank'}}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Zoom Controls -->
            <div class="flex flex-col gap-px rounded-xl bg-background-dark/70 shadow-xl backdrop-blur-sm overflow-hidden">
                <!-- Zoom In -->
                <button (click)="zoomIn()" class="flex h-12 w-12 items-center justify-center text-white transition-colors hover:bg-primary/20">
                    <span class="material-symbols-outlined">add</span>
                </button>
                <div class="h-px w-full bg-white/10"></div>
                <!-- Zoom Out -->
                <button (click)="zoomOut()" class="flex h-12 w-12 items-center justify-center text-white transition-colors hover:bg-primary/20">
                    <span class="material-symbols-outlined">remove</span>
                </button>
            </div>
        </div>
    </main>
</div>



