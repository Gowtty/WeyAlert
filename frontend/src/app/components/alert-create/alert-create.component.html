<div class="flex flex-col min-h-screen bg-background-light dark:bg-background-dark font-display text-white">
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h2 class="text-4xl font-bold text-black dark:text-white mb-8">Reportar Alerta</h2>

        <!-- Mensaje de estado -->
        <div *ngIf="apiMessage" 
             class="mb-6 p-4 rounded-lg"
             [class.bg-green-500]="isSuccess"
             [class.bg-red-500]="!isSuccess">
            {{ apiMessage }}
        </div>

        <form [formGroup]="alertForm" (ngSubmit)="onSubmit()" class="space-y-6">
            <!-- Selección de Categoría -->
            <div>
                <label class="block text-sm font-medium text-white/70 mb-2">Categoría</label>
                <select 
                    formControlName="category"
                    class="w-full bg-background-dark/50 border border-gray-700 rounded-lg h-12 px-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">Selecciona una categoría</option>
                    <option *ngFor="let category of categories" [value]="category.id">
                        {{ category.name }}
                    </option>
                </select>
                <div *ngIf="alertForm.get('category')?.invalid && alertForm.get('category')?.touched" 
                     class="text-red-500 text-sm mt-1">
                    La categoría es requerida.
                </div>
            </div>

            <!-- Título -->
            <div>
                <label class="block text-sm font-medium text-white/70 mb-2">Título</label>
                <input 
                    type="text" 
                    formControlName="title"
                    class="w-full bg-background-dark/50 border border-gray-700 rounded-lg h-12 px-4 text-white focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="Ej: Accidente en avenida principal">
                <div *ngIf="alertForm.get('title')?.invalid && alertForm.get('title')?.touched" 
                     class="text-red-500 text-sm mt-1">
                    <div *ngIf="alertForm.get('title')?.errors?.['required']">El título es requerido.</div>
                    <div *ngIf="alertForm.get('title')?.errors?.['maxlength']">El título no puede tener más de 200 caracteres.</div>
                </div>
            </div>

            <!-- Descripción -->
            <div>
                <label class="block text-sm font-medium text-white/70 mb-2">Descripción</label>
                <textarea 
                    formControlName="description"
                    rows="4"
                    class="w-full bg-background-dark/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-primary focus:border-transparent"
                    placeholder="Describe lo que está sucediendo..."></textarea>
                <div *ngIf="alertForm.get('description')?.invalid && alertForm.get('description')?.touched" 
                     class="text-red-500 text-sm mt-1">
                    La descripción es requerida.
                </div>
            </div>

            <!-- Ubicación (solo lectura) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-white/70 mb-2">Latitud</label>
                    <input 
                        type="text" 
                        formControlName="latitude"
                        readonly
                        class="w-full bg-background-dark/30 border border-gray-700 rounded-lg h-12 px-4 text-white/70">
                </div>
                <div>
                    <label class="block text-sm font-medium text-white/70 mb-2">Longitud</label>
                    <input 
                        type="text" 
                        formControlName="longitude"
                        readonly
                        class="w-full bg-background-dark/30 border border-gray-700 rounded-lg h-12 px-4 text-white/70">
                </div>
            </div>

            <!-- Imagen (opcional) -->
            <div>
                <label class="block text-sm font-medium text-white/70 mb-2">Imagen (opcional)</label>
                <div class="flex items-center gap-4">
                    <button 
                        type="button"
                        (click)="triggerFileInput()"
                        class="px-4 py-2 bg-primary text-background-dark font-bold rounded-lg hover:bg-primary/90 transition-all">
                        Seleccionar Imagen
                    </button>
                    <span *ngIf="selectedImage" class="text-white/70">{{ selectedImage.name }}</span>
                </div>
                <input 
                    type="file" 
                    id="image-input" 
                    class="hidden" 
                    accept="image/*" 
                    (change)="onFileSelected($event)">
                
                <!-- Vista previa de la imagen -->
                <div *ngIf="imagePreviewUrl" class="mt-4">
                    <img [src]="imagePreviewUrl" alt="Vista previa" class="max-w-xs rounded-lg">
                    <button 
                        type="button"
                        (click)="removeImage()"
                        class="mt-2 px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all">
                        Eliminar Imagen
                    </button>
                </div>
            </div>

            <!-- Botones -->
            <div class="flex gap-4 pt-4">
                <button 
                    type="button"
                    (click)="router.navigate(['/map'])"
                    class="flex-1 px-8 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition-all duration-300">
                    Cancelar
                </button>
                <button 
                    type="submit"
                    [disabled]="isSubmitting || alertForm.invalid"
                    class="flex-1 px-8 py-3 bg-primary text-background-dark font-bold rounded-lg hover:bg-primary/90 transition-all duration-300 disabled:opacity-50">
                    <span *ngIf="!isSubmitting">Reportar Alerta</span>
                    <span *ngIf="isSubmitting">Enviando...</span>
                </button>
            </div>
        </form>
    </main>
</div>